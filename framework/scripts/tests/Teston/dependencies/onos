# Copyright (c) 2013 Hewlett-Packard Development Company, L.P.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
# implied.
# See the License for the specific language governing permissions and
# limitations under the License.


#!/bin/bash
# -----------------------------------------------------------------------------
# ONOS remote command-line client.
# -----------------------------------------------------------------------------

[ ! -d "$ONOS_ROOT" ] && echo "ONOS_ROOT is not defined" >&2 && exit 1
. /root/.bashrc
. $ONOS_ROOT/tools/build/envDefaults
. $ONOS_ROOT/tools/test/bin/find-node.sh

[ "$1" = "-w" ] && shift && onos-wait-for-start $1

[ -n "$1" ] && OCI=$(find_node $1) && shift

if which client 1>/dev/null 2>&1 && [ -z "$ONOS_USE_SSH" ]; then
    # Use Karaf client only if we can and are allowed to
    unset KARAF_HOME
    client -h $OCI -u karaf "$@" 2>/dev/null
else
    # Otherwise use raw ssh; strict checking is off for dev environments only
    #ssh -p 8101 -o StrictHostKeyChecking=no $OCI "$@"
    sshpass -p karaf ssh -l karaf -p 8101 $OCI "$@"
fi
